@model IDP_Back_End.Models.CheckListItem
@using IDP_Back_End.Models;

<div class="row" style="margin: 10px;">
    <div class="checklist-item">
        <input id="text-@Model.ID" style="width: 70px; overflow: hidden; white-space: nowrap;" value="@Model.Text">
        <input type="checkbox" id="done" name="done" checked="@Model.Done">
    </div>
    <form id="addCheckListItemForm" asp-action="Delete" asp-controller="CheckListItem" method="delete">
        <input type="hidden" name="id" value="@Model.ID" />
        <span class="card-text p-1">
            <input type="submit" value="Delete" style="float:right">
        </span>
    </form>
    <script>
        document.getElementById("text-" + @Model.ID).addEventListener("blur", (event) => {

            if (event.target.parentNode.childNodes[3].checked) {
                var done = true;
            } else {
                var done = false;
            }
            console.log(event.target.parentNode.childNodes[3].checked);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", window.location.origin + "/api/updateCheckListItem");
            xhr.setRequestHeader('Content-Type', 'application/json');
            console.log(JSON.stringify({
                id: @Model.ID,
                text: event.currentTarget.value,
                done: done
            }));
            xhr.send(JSON.stringify({
                id: @Model.ID,
                text: event.currentTarget.value,
                done: done
            }));

            xhr.onreadystatechange = function () {
                if (this.readyState != 4) return;

                if (this.status == 200) {
                    location.reload();
                } if (this.status == 401) {
                    // If resonse was not OK, display error
                    window.alert("Something went wrong");
                }
            };
        });
    </script>
</div>